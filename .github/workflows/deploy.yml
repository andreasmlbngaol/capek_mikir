# GitHub Actions Workflow for Flutter Web Deployment to VPS

name: Build and Deploy Flutter Web

# Triggers the workflow on push events to the main branch
on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout the repository code
      - name: Checkout Repository
        uses: actions/checkout@v3

      # 2. Set up Flutter SDK
      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable' # Or 'beta', 'dev', 'master'

      # 3. Install dependencies
      - name: Install Dependencies
        run: flutter pub get

      # 4. Build the Flutter web application
      - name: Build Flutter Web
        run: flutter build web --release

      # 5. Deploy to VPS via SCP
      - name: Deploy to VPS
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.VPS_HOST }} # Your VPS IP or domain from GitHub Secrets
          username: ${{ secrets.VPS_USERNAME }} # Your VPS username from GitHub Secrets
          key: ${{ secrets.VPS_SSH_PRIVATE_KEY }} # Your SSH private key from GitHub Secrets
          source: "build/web/" # The folder to copy
          target: "/var/www/capek_mikir" # The destination folder on your VPS
          strip_components: 2 # Removes 'build/web/' from the path, copying the contents directly
